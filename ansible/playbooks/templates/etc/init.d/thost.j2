#!/bin/bash
# chkconfig: 2345 20 80
# description: Tiddlyhost

START_DIR={{ home_dir }}

start() {
    docker compose up --detach
}

stop() {
    # The --volumes option is so that the rails-static volume is removed on
    # shutdown. It will be recreated again on startup which is what we want.
    docker compose down --volumes
}

stop-web() {
    # Should be slightly faster since the db and cache containers stay up
    docker compose rm --stop --force web app jobs
    # Make sure the rails-static volume is refreshed
    docker volume rm th_rails_static
}

cd $START_DIR

case "$1" in
    start)
        start
        ;;

    stop)
        stop
        ;;

    restart)
        stop
        start
        ;;

    reload)
        stop-web
        start
        ;;

esac

exit 0
